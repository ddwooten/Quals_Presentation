\documentclass{beamer}

% To fix an eps problem
\usepackage[outdir=./]{epstopdf}

% To fix the dumb beamer math font
\usefonttheme[onlymath]{serif}

% These two are for the beamer class
\usepackage{fancyvrb}
\usepackage{color}

% This is for figures
\usepackage{graphicx}

% This is for a pretty code font
\usepackage{courier}

%For tables
\usepackage{multirow}

% For nice matrices
\usepackage{blkarray}

% This is the path to the majority of the figures
\graphicspath{{/home/ddwooten/Dropbox/Dans_Stuff/Documents/UCB/Quals/Presentation/Figures/}}

% For equation formatting
\usepackage{amsmath}

% For sizing summations properly
\usepackage{relsize}

% For isotope notation
\usepackage{mhchem}

% Biblography Style
\bibliographystyle{elsarticle-num}

\definecolor{forestgreen(web)}{rgb}{0.13, 0.55, 0.13}
\definecolor{cardinal}{rgb}{0.77, 0.12, 0.23}
\mode<presentation>
{
  \definecolor{berkeleyblue}{HTML}{003262}
  \definecolor{berkeleygold}{HTML}{FDB515}
  \usetheme{Boadilla}      % or try Darmstadt, Madrid, Warsaw, ...
  %\usecolortheme{dove} % or try albatross, beaver, crane, ...
  \setbeamercolor{structure}{fg=berkeleyblue,bg=berkeleygold}
  \setbeamercolor{palette primary}{fg=berkeleyblue,bg=berkeleygold} % changed this
  \setbeamercolor{palette secondary}{bg=berkeleyblue,fg=white} % changed this
  \setbeamercolor{palette tertiary}{bg=berkeleyblue,fg=white} % changed this
  \usefonttheme{structurebold}  % or try serif, structurebold, ...
  \useinnertheme{circles}
  \setbeamertemplate{navigation symbols}{}
  \setbeamertemplate{caption}[numbered]
  \usebackgroundtemplate{}
}

\title[Modeling of Material Transfers in MSRs]{Modeling of Material Transfers in  Reactor Fuel Burnup Simulations}
\author{Daniel D. Wooten}
\institute{UC Berkeley}
\date{October 20\textsuperscript{th}, 2017}

\begin{document}

\frame{\titlepage}

\begin{frame}

\frametitle{Outline}

    \begin{itemize}
        \item Molten salt reactors ( MSR ) 
        \item Fuel salt evaluation 
        \item ADDER
        \item Keeping the problem linear
        \item The optimal solution
        \item Modifying the Bateman equations
        \item Designing for parallel operation
        \item Verification and Validation
        \item Future Work
        \item References
    \end{itemize}

\end{frame}

\begin{frame}
\frametitle{How much code do you want to see?}

\end{frame}

\begin{frame}
\frametitle{What is an MSR?}

    \begin{figure}
        \centering
        \includegraphics[width=0.75\paperwidth, keepaspectratio]{MSR}
        \caption{Figure courtesy of Idaho National Labs}
        \label{fig:msr}
    \end{figure}

\end{frame}

\begin{frame}
\frametitle{Fuel Salt Selection}

Considerations \ldots

    \begin{itemize}
        \item Structural materials corrosion 
        \item Heavy element solubility
        \item Isotopic evolution
    \end{itemize}

\end{frame}

\begin{frame}
\frametitle{The question}

How does the fuel salt composition in a molten salt fueled reactor change over
time in response to both nuclear fuel burnup and reactor operator actions?

\end{frame}

\begin{frame}
\frametitle{Finding the answer}

    The few general purpose tools that exist to address this question only
    consider feed and removal processes. 

\hspace{2cm}

For better answers we need better tools.

\end{frame}

\begin{frame}
\frametitle{Pertinent phenomena}

    \begin{itemize}
        \item Solubility
        \item Reduction - Oxidation ( Redox ) potential of the salt
        \item Criticality control 
        \item Available chemical forms
    \end{itemize}

\end{frame}

\begin{frame}
\frametitle{Advanced Dynamic Depletion Extension for Reprocessing - ADDER}

A source code modification to the SERPENT 2 Monte Carlo code which enables the
user to \ldots

    \begin{itemize}
        \item define material transfers into, out of, and between SERPENT materials
        \item define and enforce relationships between isotopes, elements, and chemicals in SERPENT materials
        \item define system $k_{eff}$ targets
        \item define a weighted-average target for the oxidation state of a given SERPENT material
    \end{itemize}

\end{frame}

\begin{frame}
\frametitle{But what does ADDER \textit{do}?}

    ADDER determines the material transfers needed to achieve the optimal
    composition for SERPENT materials given a set of constraints.

\end{frame}

\begin{frame}
\frametitle{How does it all work?}

Observe the humble \textbf{\textit{stream}}

\hspace{2cm}

\small{\texttt{stream to Tank from Reactor group UF4 type feed form cont}}

\end{frame}

\begin{frame}
\frametitle{The group}

\small{\texttt{stream to Tank from Reactor \textbf{group UF4} type feed form cont}}

\hspace{2cm}

\texttt{grp UF4}\\
\texttt{F   4}\\
\texttt{U   1   isos    2}\\
\texttt{    U-233    5}\\
\texttt{    U-238   95}

\end{frame}

\begin{frame}
\frametitle{Constituent relationships}

    \begin{itemize}
        \item Minimum and maximum group fractions in a material
        \item Minimum and maximum ratios between groups
    \end{itemize}

\end{frame}

\begin{frame}
\frametitle{Charge balancing}

Fission events may be either be reducing or oxidizing in nature. Operator
actions may be either reducing or oxidizing.

\hspace{2cm}

$UserTarget = \sum\limits_{e}^{E}w_{e}*N_{e}$

\end{frame}

\begin{frame}
\frametitle{Reactivity control}

    \begin{equation}
    \label{nufis}
        \nu_{f}^{i}\Sigma_{f}^{i} = \frac{\int\limits_{0}^{\infty}\nu_{f}^{i}(E)\Sigma_{f}^{i}(E)\phi(E)dE}{\int\limits_{0}^{\infty}\phi(E)dE}
    \end{equation}

    \begin{equation}
    \label{reactivity_sum}
        k_{eff} = p_{n\ell}\left(\frac{\sum\limits_{i}^{I}\nu_{f}^{i}\Sigma_{f}^{i}}{\sum\limits_{i}^{I}\Sigma_{a}^{i}}\right)
    \end{equation}

\end{frame}

\begin{frame}
\frametitle{Reactivity control}

    \begin{equation}
    \label{max_reac}
        \frac{k_{eff}^{max}}{p_{n\ell}}\sum\limits_{i}^{I}\Sigma_{a}^{I} - \sum\limits_{i}^{I}\nu_{f}^{i}\Sigma_{f}^{i} < 0
    \end{equation}

    \begin{equation}
    \label{max_reac}
        \frac{k_{eff}^{min}}{p_{n\ell}}\sum\limits_{i}^{I}\Sigma_{a}^{I} - \sum\limits_{i}^{I}\nu_{f}^{i}\Sigma_{f}^{i} > 0   
    \end{equation}

\end{frame}

\begin{frame}
\frametitle{Linear optimization}

    The simplex algorithm

\end{frame}

\begin{frame}
\frametitle{CLP}

    \textbf{COIN-OR} \textbf{L}inear \textbf{P}rogramming is part of the larger
    \textit{Computational Infrastructure for Operations Research} project.
    CLP, as noted by 
    \cite{gearhart_comparison_2013}, ``\textit{was the best solver of} [the open-source linear programming solvers] \textit{considered, in terms of
     capability and performance.}"

\end{frame}

\begin{frame}[shrink=25]
\frametitle{Bringing it all together}

    \begin{equation*}
        \begin{blockarray}{cccccccccc}
                               &                   & [a,b]             &
            [0,1]              & (-\infty,\infty)  & (-\infty,\infty)  &
            [0,1]              & (-\infty,\infty)  & [0,1]             &
            (-\infty,\infty)  \\ 
                               &                   & g_{1}             &
            g_{2}              & s_{1}             & s_{2}             &
            E_{f}^{1}          & E_{d}^{1}         & I_{f}^{1}         &
            I_{d}^{1} \\
                               &                   &                   &
                               &                   &                   &
                               &                   &                   &
             \\ 
            \begin{block}{cc[cccccccc]}
            {(-\infty,0]}      & Rto_{m}           & -1                &
            m                  &                   &                   &
                               &                   &                   &
             \\
            {[0,\infty)}       & Rto_{M}           & -1                &
            M                  &                   &                   &
                               &                   &                   &
             \\
            {[-1,0]}           & E_{f}^{1}         & f_{g_{1}}^{E^{1}} &
            f_{g_{2}}^{E^{1}}  &                   &                   &
            -1                 &                   &                   &
             \\
            {[0,0]}            & E_{d}^{1}         &                   &
                               & f_{s_{1}}^{E^{1}} & f_{s_{2}}^{E^{1}} &
                               & -1                &                   &
             \\
            {[E_{c}^{1},E_{c}^{1}]} 
                               & E_{b}^{1}         &                   &
                               &                   &                   &
            1                  & -1                &                   &
             \\
            {[0,0]}            & E_{i}^{1}         &                   &
                               &                   &                   &
                               &                   & 1                 &
             \\
            {[-1,0]}           & I_{f}^{1}         & f_{g_{1}}^{I^{1}} &
            f_{g_{2}}^{I^{1}}  &                   &                   &
                               &                   & -1                &
             \\
            {[0,0]}            & I_{d}^{1}         &                   &
                               & f_{s_{1}}^{I^{1}} & f_{s_{2}}^{I^{1}} &
                               &                   &                   &
            -1 \\
            {[I_{c}^{1},I_{c}^{!}]}
                               & I_{b}^{1}         &                   &
                               &                   &                   &
                               &                   & 1                 &
            -1 \\ 
            {(-\infty,0]}      & \rho_{max}        &                   &
                               &                   &                   &
                               &                   & c                 &
             \\
            {[0,\infty)}       & \rho_{min}        &                   &
                               &                   &                   &
                               &                   & d                 & 
             \\
            {[e,f]}            & Oxi               &                   &
                               &                   &                   &
             oxi^{E^{1}}       &                   &                   &
             \\
            {[0,0]}            & Pres              &                   &
                               & 1                 & 1                 &
                               &                   &                   &
             \\
                               & Opt               & 1                 &
                               &                   &                   &
                               &                   &                   &
             \\
            \end{block}
        \end{blockarray}
    \end{equation*}

\end{frame}

\begin{frame}
\frametitle{The Bateman Equation}

    \begin{equation}
    \begin{split}
        \frac{\partial N_{i}(\vec{r},t)}{\partial t} = & \sum \limits_{j}^{N} 
        b_{j \rightarrow i} \lambda_{j} N_{j}(\vec{r}, t) + \\
        & \sum \limits_{k}^{N}
        \sum \limits_{q}^{Q} \int_{0}^{\infty} f_{k \rightarrow i}^{q}(E)
        \sigma_{q}^{k}(E) \phi(\vec{r},E,t) N_{k}(\vec{r},t)\mathrm{d}E - \\
        & N_{i}(\vec{r},t) \lambda_{i} - \sum \limits_{d}^{D} \int_{0}^{\infty}
        \sigma_{d}^{i}(E) \phi(\vec{r},E,t) N_{i}(\vec{r},t)\mathrm{d}E - \\
        & R_{i}(\vec{r},t) N_{i}(\vec{r},t) + F_{i}(\vec{r},t)
    \end{split}
    \end{equation}

\end{frame}

\begin{frame}
\frametitle{The depletion matrix}

    \begin{equation*}
        \begin{blockarray}{cccccc}
             &
            \ce{^{233}_{92}U} &
            \ce{^{135}_{54}Xe} &
            S_{c} &
            S_{p} &
            \mathbb{N} \\
             &
             &
             &
             &
             &
             \\ 
        \begin{block}{c[cccc][c]}
            \ce{^{233}_{92}U} &
            -\lambda_{\ce{^{233}U}} + \gamma &
             &
            f_{S_{c}}^{\ce{^{233}U}} &
             &
            N_{\ce{^{233}U}} \\
            \ce{^{135}_{54}Xe} &
            \delta &
            -\lambda_{\ce{^{135}Xe}} + \lambda_{S_{p}}^{\ce{^{135}Xe}} +
                \epsilon &
             &
             &
            N_{\ce{^{135}Xe}} \\
            S_{c} &
             &
             &
             &
             &
            amt_{S_{c}} \\
            S_{p} &
             &
            \lambda_{S_{p}}^{\ce{^{135}Xe}} &
             &
             &
             1\\
        \end{block}
        \end{blockarray}
    \end{equation*}

\end{frame}

\begin{frame}
\frametitle{SERPENT 2 in parallel}

    \begin{figure}
        \centering
        \includegraphics[width=0.9\paperwidth, keepaspectratio]{Parallel_Serpent}
        \caption{Schematic of SERPENT 2's parallel operation}
        \label{fig:parallel_serpent}
    \end{figure}

\end{frame}

\begin{frame}
\frametitle{Verification and Validation}

    Verification \ldots

    \hspace{1cm}

    \begin{itemize}
        \item Over 300 unit tests (approx. 1 unit test / 20 lines of code )
        \item Two integration test suites comprising some 5k+ lines of code
        \item System tests are in development
    \end{itemize}

    \hspace{2cm}

    Validation \ldots

    \hspace{1cm}

    \begin{itemize}
        \item May be able to validate some or all of the code with data from
            the oklo reactor
        \item Inter-code comparison
    \end{itemize}

\end{frame}

\begin{frame}
\frametitle{Future work}

    \begin{itemize}

        \item Finish system testing
        \item Finish alpha version of ADDER
        \item Redo system testing
        \item Compile final documentation
        \item Investigate various fuel cycles

    \end{itemize}

\end{frame}

\begin{frame}
\frametitle{In conclusion\ldots}

    Questions?

\end{frame}

\begin{frame}
\frametitle{Acknowledgements}

    This material is based upon work supported under a Department of Energy,
    Office of Nuclear Energy, Integrated University Program Graduate Fellowship.

\end{frame}

\begin{frame}[allowframebreaks]
\frametitle{References}

\bibliography{Quals}

\end{frame}

\begin{frame}
\frametitle{Corrosion by fuel salts}

    \begin{itemize}
        \item 316 Stainless steel, in a 316L stainless steel crucible, in FLiNaK (46.5\%LiF - 11.5\%NaF - 42\%KF) salt has a reported corrosion rate of 17.1$\mu$m/yr. \cite{zheng_corrosion_2015}
        \item 316 Stainless steel, in a 316L stainless steel crucible, in FLiBe salt has a reported corrosion rate of 125$\mu$m/yr $\pm$12.5$\mu$m/yr. \cite{sellers_materials_2012}
    \end{itemize}

\end{frame}

\begin{frame}
\frametitle{Heavy element solubility}

    \begin{figure}
        \centering
        \includegraphics[width=0.5\paperwidth, keepaspectratio]{LiF_UF4_ThF4_Liquidus}
        \caption{Figure 5.2 from \cite{rosenthal_development_1972}}
        \label{fig:salt_liquidus}
    \end{figure}

\end{frame}

\begin{frame}
\frametitle{Redox potential and oxidation state}

    \begin{equation}
    \label{Nernst}
        \epsilon_{i} = \epsilon_{i}^{o} + \frac{RT}{z\mathfrak{J}}\ln\left(\frac{[oxid]}{[red]}\right)
    \end{equation}

\end{frame}

\begin{frame}
\frametitle{Simplex 1}

    Maximize $f(x_{0},\ldots,x_{n})$ where $f$ is linear, $x_{i}\geq0$ subject
    to $Mx=v$ where $M$ is an $mxn$ matrix and $v$ is an $mx1$ column vector.

\end{frame}

\begin{frame}
\frametitle{Simplex 2}

    This example is taken from \texttt{Linear Algebra} by Cherney et. al.

    \hspace{2cm}

    Maximize $f(x,y,z,w) = 3x - 3y - z + 4w$ subject to constraints \ldots

    \hspace{2cm}

    \begin{equation}
    \label{c1}
        c_{1} := x + y + z + w = 5
    \end{equation}

    \begin{equation}
    \label{c2}
        c_{2} := x + 2y + 3z + 2w = 6 
    \end{equation}

\end{frame}
    
\begin{frame}
\frametitle{Simplex 3}

    In the event that $x_{i} \ngeq 0$ simply define a new variable $x_{k} = x_{i} - \beta$ where $\beta$ is chosen to satisfy the $\geq$ requirement.\\
    The same solution applies to constraints which are not equalities.\\
    And what happens if all your coefficients in the last row are positive from
    the get go? Add more slack variables and ramp up the $\alpha$ on each one,
    subtract them from the constraints and the objective.

\end{frame}

\begin{frame}
\frametitle{Simplex 4}

    Minimize $s = 5x + 10y$ subject to $x \geq 5$, $y \geq 7$, $x + y \geq 15$,
    and $x + y \leq 25$.

\end{frame}

\begin{frame}
\frametitle{Computational intensity}

    \begin{itemize}
        \item The simplex algorithm has worst case performance $O(2^{n})$ \cite{klee_how_1969}
        \item CRAM as implemented in SERPENT 2 would appear to have $ O(n^{2})$ complexity
    \end{itemize}

\end{frame}

\begin{frame}
\frametitle{SERPENT MPI performance} 

    \begin{figure}
        \centering
        \includegraphics[width=0.75\paperwidth, keepaspectratio]{SERPENT_MPI}
        \caption{Figure 10.12 from \cite{jaakko_leppanen_development_2007}}
        \label{fig:serpent_mpi}
    \end{figure}

\end{frame}

\begin{frame}
\frametitle{Speed of CRAM}

This information is taken from \cite{isotalo_comparison_2011}.

    \begin{itemize}
        \item Maximum relative error in the study was $10^{-3}$ for CRAM
        \item Average errors were around $10^{-10}$
        \item Time per step was about 0.05 seconds ( 3 GHz processor, 64 bit linux )
    \end{itemize}

\end{frame}

\end{document}
